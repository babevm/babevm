<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Babe VM: src/c/debugger/debugger-cmd-15-eventrequest.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Babe VM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('debugger-cmd-15-eventrequest_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">debugger-cmd-15-eventrequest.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="bvm_8h_source.html">../../h/bvm.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aee22f6e189cdb4072c2cfca1cd30ef9a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="debugger-cmd-15-eventrequest_8c.html#aee22f6e189cdb4072c2cfca1cd30ef9a">bvmd_ch_ER_Set</a> (<a class="el" href="debugger-io_8h.html#a5a711b55f4e1d62ad9f6b7f78f2e06ba">bvmd_instream_t</a> *in, <a class="el" href="debugger-io_8h.html#a3e3afc3103c4be7c05891bfe064dc34a">bvmd_outstream_t</a> *out)</td></tr>
<tr class="separator:aee22f6e189cdb4072c2cfca1cd30ef9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02f1fa32ebc5b3e2a270c4353b1610c9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="debugger-cmd-15-eventrequest_8c.html#a02f1fa32ebc5b3e2a270c4353b1610c9">bvmd_eventdef_clearall</a> ()</td></tr>
<tr class="separator:a02f1fa32ebc5b3e2a270c4353b1610c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad085e580e5997b3bb106f3534c671e4d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="debugger-cmd-15-eventrequest_8c.html#ad085e580e5997b3bb106f3534c671e4d">bvmd_ch_ER_Clear</a> (<a class="el" href="debugger-io_8h.html#a5a711b55f4e1d62ad9f6b7f78f2e06ba">bvmd_instream_t</a> *in, <a class="el" href="debugger-io_8h.html#a3e3afc3103c4be7c05891bfe064dc34a">bvmd_outstream_t</a> *out)</td></tr>
<tr class="separator:ad085e580e5997b3bb106f3534c671e4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40d3564a78c51070493675671710743a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="debugger-cmd-15-eventrequest_8c.html#a40d3564a78c51070493675671710743a">bvmd_ch_ER_ClearAllBreakpoints</a> (<a class="el" href="debugger-io_8h.html#a5a711b55f4e1d62ad9f6b7f78f2e06ba">bvmd_instream_t</a> *in, <a class="el" href="debugger-io_8h.html#a3e3afc3103c4be7c05891bfe064dc34a">bvmd_outstream_t</a> *out)</td></tr>
<tr class="separator:a40d3564a78c51070493675671710743a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:af6277e5eed7cc2179accbb3859caa5df"><td class="memItemLeft" align="right" valign="top">bvm_uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="debugger-cmd-15-eventrequest_8c.html#af6277e5eed7cc2179accbb3859caa5df">bvmd_gl_registered_events</a> = 0</td></tr>
<tr class="separator:af6277e5eed7cc2179accbb3859caa5df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40f3d1eaacfdb4e561937c690796469e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="debugger-events_8h.html#a46eecbdb85e137a6bbd49bf2570d8a58">bvmd_eventdef_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="debugger-cmd-15-eventrequest_8c.html#a40f3d1eaacfdb4e561937c690796469e">bvmd_gl_eventdefs</a> = NULL</td></tr>
<tr class="separator:a40f3d1eaacfdb4e561937c690796469e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7a6d67ccb8c43240fede0a45b44990f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="clazz_8h.html#aad944a281f999674be45ed9044896991">bvm_clazz_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="debugger-cmd-15-eventrequest_8c.html#ad7a6d67ccb8c43240fede0a45b44990f">bvmd_gl_unloaded_clazzes</a> = NULL</td></tr>
<tr class="separator:ad7a6d67ccb8c43240fede0a45b44990f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>JDWP EventRequest commandset command handlers.</p>
<h1><a class="anchor" id="eventdef-eventdefs"></a>
Event Definitions</h1>
<p>As the debugger sends requests for debuggee events that it is interested in, they are processed and stored internally as "event definitions".</p>
<p>An Event Definition (or 'eventdef') is a <a class="el" href="debugger-events_8h.html#a46eecbdb85e137a6bbd49bf2570d8a58">bvmd_eventdef_t</a> structure instance that holds information about a particular event request made by the debugger. Each eventdef has a JDWP 'eventkind'.</p>
<p>Each new eventdef is placed into a global linked list (<a class="el" href="debugger-cmd-15-eventrequest_8c.html#a40f3d1eaacfdb4e561937c690796469e">bvmd_gl_eventdefs</a>).</p>
<p>As each eventdef is received and processed, its eventkind is also registered into a single consolidated bvm_int32_t (<a class="el" href="debugger-cmd-15-eventrequest_8c.html#af6277e5eed7cc2179accbb3859caa5df">bvmd_gl_registered_events</a>). Each JDWP eventkind is translated to a 'DBG eventkind' that can be applied as a simple mask on the <code>bvmd_gl_registered_events</code> bvm_int32_t to set a bit and help quickly determine whether a given eventkind is registered. Notice each JDWP eventkind has a corresponding DBG eventkind. The JDWP eventkinds numbers are not amenable to any kind of quick lookup structure, so this simple translation is effective.</p>
<p>As eventdefs are cleared by the debugger, the <code>bvmd_gl_registered_events</code> bvm_int32_t is recalculated to make sure it only contains those eventkinds that are actually still registered.</p>
<h1><a class="anchor" id="eventdef-modifiers"></a>
Modifiers</h1>
<p>Each eventdef may contain a number of 'modifiers'. Modifiers are actually 'filters' provided by the debugger with an event request to narrow down the applicability of a given eventdef. For example, a breakpoint eventdef has a modifier that restricts the location.</p>
<p>As the event request is read and processed into its internal <a class="el" href="debugger-events_8h.html#a46eecbdb85e137a6bbd49bf2570d8a58">bvmd_eventdef_t</a> form, the modifiers are also read and processed and held with the eventdef as an array of <a class="el" href="debugger-events_8h.html#a4917f6964ceeaa3ce7815b80b660cea3">bvmd_event_modifier_t</a>.</p>
<p>There are a number of different modifier types and each modifier holds just on at a time. The type of a modifier is defined by its 'modifier kind'.</p>
<p>Notice the <a class="el" href="debugger-events_8h.html#a4917f6964ceeaa3ce7815b80b660cea3">bvmd_event_modifier_t</a> structure is actually a union of smaller structures - one for each different modifier kind. This provides a way to treat all modifiers in the same way.</p>
<p>Each modifier holds just enough information to be useful for its kind. Some modifiers compare against clazzes and methods and so on. As usual, the debugger sends the ID of these with the modifier definition. It is worth noting at this point that most of the modifiers that deal with comparisons against 'things with an ID' actually resolve the ID immediately and store a direct pointer in the internalised modifier. The modifiers that do this are using those pointers strictly for equality <em>comparison</em> - nothing further - so if the pointer actually is no longer valid, no harm will be done. Some other modifiers actually <em>use</em> the thing represented by the ID. For example, the "exception only" modifier must test whether a thrown exception's clazz is a subclazz of the clazz represented by the modifier clazz ID. If the clazz has been GC'd, any bvm_clazz_t pointers will be invalid, and using it may cause things to blow up. For this reason .. some modifiers store IDs and perform dbg id map lookups each time. If the ID is not in the map, the memory has been GC'd and thus the modifier test must fail.</p>
<h1><a class="anchor" id="eventdef-clearing"></a>
Clearing Event Definitions</h1>
<p>Some eventkinds require some extra care when setting and clearing. When a breakpoint event request is received, the actual bytecode it refers to is replaced with an <a class="el" href="exec_8h.html#ae0c56956fa76ee68b21b0ec49059034f">OPCODE_breakpoint</a> opcode - the execution loop uses this opcode to handle breakpoints. Conversely, when a breakpoint is cleared the displaced opcode must be put back into its original position.</p>
<p>Similarly, a single-step eventdef requires some state information being stored with the single-stepping thread, and being cleared when the single step eventdef is cleared.</p>
<p>Event handling really has two faces - one side is the actual registration and clearing of event requests (and their modifiers) from a debugger (all handled in this unit), the other is the creation and sending to the debugger of events that meets the debuggers criteria. This happens in <code><a class="el" href="debugger-cmd-64-event_8c.html">debugger-cmd-64-event.c</a></code> </p>
<dl class="section author"><dt>Author</dt><dd>Greg McCreath </dd></dl>
<dl class="section since"><dt>Since</dt><dd>0.0.10 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad085e580e5997b3bb106f3534c671e4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad085e580e5997b3bb106f3534c671e4d">&#9670;&nbsp;</a></span>bvmd_ch_ER_Clear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bvmd_ch_ER_Clear </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="debugger-io_8h.html#a5a711b55f4e1d62ad9f6b7f78f2e06ba">bvmd_instream_t</a> *&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="debugger-io_8h.html#a3e3afc3103c4be7c05891bfe064dc34a">bvmd_outstream_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>JDWP Command handler for EventRequest/Clear.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">in</td><td>the request input stream </td></tr>
    <tr><td class="paramname">out</td><td>the response output stream </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a40d3564a78c51070493675671710743a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40d3564a78c51070493675671710743a">&#9670;&nbsp;</a></span>bvmd_ch_ER_ClearAllBreakpoints()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bvmd_ch_ER_ClearAllBreakpoints </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="debugger-io_8h.html#a5a711b55f4e1d62ad9f6b7f78f2e06ba">bvmd_instream_t</a> *&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="debugger-io_8h.html#a3e3afc3103c4be7c05891bfe064dc34a">bvmd_outstream_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>JDWP Command handler for EventRequest/ClearAllBreakpoints.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">in</td><td>the request input stream </td></tr>
    <tr><td class="paramname">out</td><td>the response output stream </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aee22f6e189cdb4072c2cfca1cd30ef9a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee22f6e189cdb4072c2cfca1cd30ef9a">&#9670;&nbsp;</a></span>bvmd_ch_ER_Set()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bvmd_ch_ER_Set </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="debugger-io_8h.html#a5a711b55f4e1d62ad9f6b7f78f2e06ba">bvmd_instream_t</a> *&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="debugger-io_8h.html#a3e3afc3103c4be7c05891bfe064dc34a">bvmd_outstream_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>JDWP Command handler for EventRequest/Set.</p>
<p>Read a debugger 'event set' request and internalises it into an <a class="el" href="debugger-events_8h.html#a46eecbdb85e137a6bbd49bf2570d8a58">bvmd_eventdef_t</a> in the global eventdefs list <a class="el" href="debugger-cmd-15-eventrequest_8c.html#a40f3d1eaacfdb4e561937c690796469e">bvmd_gl_eventdefs</a>. Each event modifier is internalised into an <a class="el" href="debugger-events_8h.html#a4917f6964ceeaa3ce7815b80b660cea3">bvmd_event_modifier_t</a> housed in an array of modifiers on the eventdef.</p>
<p>Additionally, registers the eventkind in the global eventkind bitmap <a class="el" href="debugger-cmd-15-eventrequest_8c.html#af6277e5eed7cc2179accbb3859caa5df">bvmd_gl_registered_events</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">in</td><td>the request input stream </td></tr>
    <tr><td class="paramname">out</td><td>the response output stream </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a02f1fa32ebc5b3e2a270c4353b1610c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02f1fa32ebc5b3e2a270c4353b1610c9">&#9670;&nbsp;</a></span>bvmd_eventdef_clearall()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bvmd_eventdef_clearall </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clear all registered events. After this function the global eventdefs list (<a class="el" href="debugger-cmd-15-eventrequest_8c.html#a40f3d1eaacfdb4e561937c690796469e">bvmd_gl_eventdefs</a>) will be <code>NULL</code> and the registered eventkind bitmap (<a class="el" href="debugger-cmd-15-eventrequest_8c.html#af6277e5eed7cc2179accbb3859caa5df">bvmd_gl_registered_events</a>) will be zero.</p>
<p>While clearing, if an eventdef is either a breakpoint, or a singlestep, specific processing is undertaken to clear those properly. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a40f3d1eaacfdb4e561937c690796469e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40f3d1eaacfdb4e561937c690796469e">&#9670;&nbsp;</a></span>bvmd_gl_eventdefs</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="debugger-events_8h.html#a46eecbdb85e137a6bbd49bf2570d8a58">bvmd_eventdef_t</a>* bvmd_gl_eventdefs = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Head of a global linked list of <a class="el" href="debugger-events_8h.html#a46eecbdb85e137a6bbd49bf2570d8a58">bvmd_eventdef_t</a> event definitions </p>

</div>
</div>
<a id="af6277e5eed7cc2179accbb3859caa5df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6277e5eed7cc2179accbb3859caa5df">&#9670;&nbsp;</a></span>bvmd_gl_registered_events</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bvm_uint32_t bvmd_gl_registered_events = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Global holder of registered event kinds. One DBG event kind per bit is stored in this bvm_uint32_t. </p>

</div>
</div>
<a id="ad7a6d67ccb8c43240fede0a45b44990f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7a6d67ccb8c43240fede0a45b44990f">&#9670;&nbsp;</a></span>bvmd_gl_unloaded_clazzes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="clazz_8h.html#aad944a281f999674be45ed9044896991">bvm_clazz_t</a>* bvmd_gl_unloaded_clazzes = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Head of a list of clazzes unloaded during GC awaiting their CLASS_UNLOAD event being sent. Clazzes here are no longer in the clazz pool, and have had all their internal structures already freed. Only the bvm_clazz_t struct remains, and any pointers it may have into permanent things like the uftstring pool. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_3b19ecf29356981f494745fbef7e56bf.html">c</a></li><li class="navelem"><a class="el" href="dir_6d3094a74f5125361c1cbd78410c720e.html">debugger</a></li><li class="navelem"><a class="el" href="debugger-cmd-15-eventrequest_8c.html">debugger-cmd-15-eventrequest.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
