<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Babe VM: src/c/trycatch.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Babe VM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('trycatch_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">trycatch.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="bvm_8h_source.html">../h/bvm.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6ce8413c6a146175c6fab88d2d3ba09d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="object_8h.html#a2b4f8c559a1a0a4eeae0bdcec0077e89">bvm_throwable_obj_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trycatch_8c.html#a6ce8413c6a146175c6fab88d2d3ba09d">bvm_create_exception</a> (<a class="el" href="clazz_8h.html#aad944a281f999674be45ed9044896991">bvm_clazz_t</a> *clazz, const char *msg)</td></tr>
<tr class="separator:a6ce8413c6a146175c6fab88d2d3ba09d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7092451c090080517f975cf27abd56f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trycatch_8c.html#aa7092451c090080517f975cf27abd56f">bvm_throw_exception</a> (const char *exception_clazz_name, const char *msg)</td></tr>
<tr class="separator:aa7092451c090080517f975cf27abd56f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1cd76b69946a9c08ec86602d60f220c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="object_8h.html#a2b4f8c559a1a0a4eeae0bdcec0077e89">bvm_throwable_obj_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trycatch_8c.html#ab1cd76b69946a9c08ec86602d60f220c">bvm_create_exception_c</a> (const char *exception_clazz_name, const char *msg)</td></tr>
<tr class="separator:ab1cd76b69946a9c08ec86602d60f220c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a7d04d0983c455f8e82969a7cb045d1e0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="trycatch_8h.html#ad6fd8e305152f5f5260668965c71c955">bvm_exception_frame_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trycatch_8c.html#a7d04d0983c455f8e82969a7cb045d1e0">bvm_gl_exception_stack</a> = &amp;_throwable_scope_struct</td></tr>
<tr class="separator:a7d04d0983c455f8e82969a7cb045d1e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Try / catch and exceptions</p>
<dl class="section author"><dt>Author</dt><dd>Greg McCreath </dd></dl>
<dl class="section since"><dt>Since</dt><dd>0.0.10</dd></dl>
<h1><a class="anchor" id="trycatch-ov"></a>
Overview</h1>
<p>The Babe try/catch exception handling mechanism is a means to use a java-like try/catch coding style at the C level.</p>
<p>The usage of BVM_TRY/BVM_CATCH at the C level obviates the requirement for the typical C idiom of returning error codes from functions and having the caller of a function check for errors. Just like Java, this VM relies on exception handling to keep its functions meaningful and uncluttered with error return codes. In Babe, function return real values, not error codes.</p>
<p>Exception handling uses the ANSI C <code>setjmp()</code> and <code>longjmp()</code> functionality. The usage of which is hidden in the <a class="el" href="trycatch_8h.html#ab5c0ed904c5bfab7df40569aae150c08">BVM_TRY</a> and <a class="el" href="trycatch_8h.html#a85f00de2139d1a382b126f7dd1fe6d73">BVM_CATCH</a> and <a class="el" href="trycatch_8h.html#a3d5eb28ee640088692b93c41fd1d3bfa">BVM_END_CATCH</a> macros.</p>
<p>It is best to think of the BVM_TRY/BVM_CATCH implementation as being a stack. In reality it is a linked list with the list linkage pointers going from the last element back to the first so it can act like a stack. Each time a 'try' is performed a new <a class="el" href="trycatch_8h.html#ad6fd8e305152f5f5260668965c71c955">bvm_exception_frame_t</a> is pushed on the stack (added to the end with a backward reference created to the previous frame). The <a class="el" href="trycatch_8h.html#ad6fd8e305152f5f5260668965c71c955">bvm_exception_frame_t</a> holds the backwards handle and also an ANSI C <code>jmp_buf</code> variable.</p>
<p>The <a class="el" href="trycatch_8h.html#abe6264ad0e0ee306dd40082b4a02b9f9">BVM_THROW</a> macro takes a Java <code>Throwable</code> object and does an ANSI C <code>longjmp()</code>. The <code>longjmp</code> will use the <code>jmp_buf</code> of the last exception frame on the try/catch stack. Execution will re-start at the last <a class="el" href="trycatch_8h.html#ab5c0ed904c5bfab7df40569aae150c08">BVM_TRY</a> macro and, because of the nature of the setjmp/longjmp usage, it will go to the code block defined by the try's adjacent <a class="el" href="trycatch_8h.html#a85f00de2139d1a382b126f7dd1fe6d73">BVM_CATCH</a> macro.</p>
<p>In this manner, no matter where a <a class="el" href="trycatch_8h.html#abe6264ad0e0ee306dd40082b4a02b9f9">BVM_THROW</a> is used, it will always go back to the last BVM_TRY used within the C execution stack.</p>
<p>Now there's a thing: The exception stack is actually contained within the C execution stack. All information for a global reference to the exception stack top, is held in local variables within normal C methods - they are hidden within the BVM_TRY/BVM_CATCH/BVM_END_CATCH macros.</p>
<h1><a class="anchor" id="trycatch-st"></a>
Exceptions and the Transient Root Stack.</h1>
<p>In addition to providing BVM_TRY/BVM_CATCH services the exception handling mechanism also tracks the top of the transient root stack. As each BVM_TRY block is entered the top of the global transient root stack is captured with the new exception frame information. When an exception is caught or the BVM_END_CATCH is passed with no exception the top of the transient root stack is restored to where is was at the entry to the BVM_TRY/BVM_CATCH.</p>
<p>In many ways a BVM_TRY/BVM_CATCH is just like a <a class="el" href="collector_8h.html#a7b159468319fec5cb4965ab5f0435acb">BVM_BEGIN_TRANSIENT_BLOCK</a> / <a class="el" href="collector_8h.html#a6c1d6c08dc0ecb98babacb93416343b7">BVM_END_TRANSIENT_BLOCK</a> combination - they both remember the top of the transient root stack when they are entered and restore it when they are exited.</p>
<h1><a class="anchor" id="trycatch-jni"></a>
.</h1>
<p>Now, after having extolled the virtues of exception handling at the C level - the Java Native Interface (JNI) specification does not use exception handling - it uses return codes. For this reason, you'll will not find exception handling in the Babe Native Interface - it follows the JNI/C idiom of using error return codes.</p>
<h1><a class="anchor" id="trycatch-vmexit"></a>
trycatch-vmexit</h1>
<p>There are actually two distinct forms of BVM_TRY/BVM_CATCH in the VM. There is the (usual) BVM_TRY/BVM_CATCH described above and there is also a BVM_VM_TRY/BVM_VM_CATCH variant that is used to signal that the VM is going to exit because of a nasty error. All operations in the VM are within a global outer BVM_VM_TRY/BVM_VM_CATCH block.</p>
<p>Basically, the BVM_VM_TRY/BVM_VM_CATCH is for VM related exit conditions and there is only one. In practice, just the BVM_TRY/BVM_CATCH need using for VM dev.</p>
<p>Unlike the BVM_TRY/BVM_CATCH blocks the BVM_VM_TRY/BVM_VM_CATCH blocks do not deal with exception objects - just an error code and a message.</p>
<p>There is, and can only be, one BVM_VM_TRY/BVM_VM_CATCH block in the entire VM. The BVM_VM_TRY/BVM_VM_CATCH blocks do not operate with a linked list in the C stack like normal BVM_TRY/BVM_CATCH does - it just uses a few globals. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a6ce8413c6a146175c6fab88d2d3ba09d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ce8413c6a146175c6fab88d2d3ba09d">&#9670;&nbsp;</a></span>bvm_create_exception()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="object_8h.html#a2b4f8c559a1a0a4eeae0bdcec0077e89">bvm_throwable_obj_t</a>* bvm_create_exception </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clazz_8h.html#aad944a281f999674be45ed9044896991">bvm_clazz_t</a> *&#160;</td>
          <td class="paramname"><em>clazz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create an exception object of the given class. The pointer to the message char array is not held. A String object is created from it (meaning the data is copied as UTF into the new String).</p>
<p>Note this method is not used by running java bytecode, only by the executing VM for its own purposes. Throwable objects produced here have their <code>needs_native_try_reset</code> field set the true.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">clazz</td><td>the class of the new exception </td></tr>
    <tr><td class="paramname">msg</td><td>the null-terminated UTF-8 encoded message for the exception. May be <code>NULL</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a new throwable object</dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">any</td><td>exception to do with class loading and object creation. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab1cd76b69946a9c08ec86602d60f220c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab1cd76b69946a9c08ec86602d60f220c">&#9670;&nbsp;</a></span>bvm_create_exception_c()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="object_8h.html#a2b4f8c559a1a0a4eeae0bdcec0077e89">bvm_throwable_obj_t</a>* bvm_create_exception_c </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>exception_clazz_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a native exception object of the given class using the bootstrap classloader.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exception_clazz_name</td><td>the class name of the exception to create. </td></tr>
    <tr><td class="paramname">msg</td><td>the message text for the exception. May be <code>NULL</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a new throwable object</dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">any</td><td>exception to do with class loading and object creation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="trycatch_8c.html#a6ce8413c6a146175c6fab88d2d3ba09d">bvm_create_exception()</a> </dd></dl>

</div>
</div>
<a id="aa7092451c090080517f975cf27abd56f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7092451c090080517f975cf27abd56f">&#9670;&nbsp;</a></span>bvm_throw_exception()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bvm_throw_exception </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>exception_clazz_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Throws a native exception of the given class name using the bootstrap class loader.</p>
<p>This function does not return.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exception_clazz_name</td><td>the class name of the exception to create. </td></tr>
    <tr><td class="paramname">msg</td><td>the message text for the exception. May be <code>NULL</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="trycatch_8h.html#abe6264ad0e0ee306dd40082b4a02b9f9">BVM_THROW</a> </dd>
<dd>
<a class="el" href="trycatch_8c.html#a6ce8413c6a146175c6fab88d2d3ba09d">bvm_create_exception()</a> </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a7d04d0983c455f8e82969a7cb045d1e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d04d0983c455f8e82969a7cb045d1e0">&#9670;&nbsp;</a></span>bvm_gl_exception_stack</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="trycatch_8h.html#ad6fd8e305152f5f5260668965c71c955">bvm_exception_frame_t</a>* bvm_gl_exception_stack = &amp;_throwable_scope_struct</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Current top of the exceptions frame stack </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_3b19ecf29356981f494745fbef7e56bf.html">c</a></li><li class="navelem"><a class="el" href="trycatch_8c.html">trycatch.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
